<!DOCTYPE html>
<html>
    <head>
        <title>Firmware : Cooling System</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">Firmware</a></span>
                            </li>
                                                    <li>
                                <span><a href="Firmware_9465365086.html">Firmware</a></span>
                            </li>
                                                    <li>
                                <span><a href="Documentation_9513894334.html">Documentation</a></span>
                            </li>
                                                    <li>
                                <span><a href="Board-Specific-Documentation_9567701653.html">Board Specific Documentation</a></span>
                            </li>
                                                    <li>
                                <span><a href="9567703480.html">PDU (Power Distribution Unit)</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            Firmware : Cooling System
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> zzakiull@uwaterloo.ca</span>, last modified on May 21, 2021
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p><style type='text/css'>/*<![CDATA[*/
div.rbtoc1665797706128 {padding: 0px;}
div.rbtoc1665797706128 ul {list-style: disc;margin-left: 0px;}
div.rbtoc1665797706128 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='toc-macro rbtoc1665797706128'>
<ul class='toc-indentation'>
<li><a href='#CoolingSystem-Overview'>Overview</a></li>
<li><a href='#CoolingSystem-StateMachineDiagram'>State Machine Diagram</a></li>
<li><a href='#CoolingSystem-Description'>Description</a></li>
<li><a href='#CoolingSystem-CommunicationwithVCU'>Communication with VCU</a></li>
<li><a href='#CoolingSystem-DTCincommon-all'>DTC in common-all</a></li>
</ul>
</div></p><h1 id="CoolingSystem-Overview">Overview</h1><p>Refer to this ticket for more info: 
    

            

    <span class="aui-message aui-message-warning jim-error-message jim-error-message-single">
        <span class="icon-in-pdf"></span>
                            Unable to locate JIRA server for this macro. It may be due to Application Link configuration.
            </span>
</p><p>The parent task is found here: 
    

            

    <span class="aui-message aui-message-warning jim-error-message jim-error-message-single">
        <span class="icon-in-pdf"></span>
                            Unable to locate JIRA server for this macro. It may be due to Application Link configuration.
            </span>
</p><h1 id="CoolingSystem-StateMachineDiagram">State Machine Diagram</h1><p>This is the current state machine diagram we have for the PDU:</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-thumbnail" height="250" loading="lazy" src="attachments/9604893237/9606694716.png?height=250" data-image-src="attachments/9604893237/9606694716.png" data-unresolved-comment-count="0" data-linked-resource-id="9606694716" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="PDU_old.png" data-base-url="https://uwaterloo.atlassian.net/wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="9604893237" data-linked-resource-container-version="15" data-media-id="b4252bc1-47a2-4d6c-b7d2-764489ffbe8e" data-media-type="file"></span></p><p>This is the proposed new state machine diagram (only State Machine 1, the cooling system, has changed):</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-thumbnail" height="250" loading="lazy" src="attachments/9604893237/9606694711.png?height=250" data-image-src="attachments/9604893237/9606694711.png" data-unresolved-comment-count="0" data-linked-resource-id="9606694711" data-linked-resource-version="2" data-linked-resource-type="attachment" data-linked-resource-default-alias="PDU.png" data-base-url="https://uwaterloo.atlassian.net/wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="9604893237" data-linked-resource-container-version="15" data-media-id="7bca7fa3-78fd-4189-a57b-ee78400008b3" data-media-type="file"></span></p><h1 id="CoolingSystem-Description">Description</h1><p>The temperature delta limit will be set to 30<span style="color: rgb(32,33,36);">°</span>C. If the temperature delta of the motor or motor controller is less than or equal to the limit, then an overtemp warning for the motor or motor controller will be sent, respectively, so motor or motor controller cooling can be turned on.</p><p>The proposed state machine design will separate the motor and motor controller cooling loops to run independently. Motor or motor controller cooling will run depending on what event is sent (e.g. motor_cool_event vs. motor_ctrl_cool_event).</p><h1 id="CoolingSystem-CommunicationwithVCU">Communication with VCU</h1><p>Below are 2 prototype functions used for sending overtemp warnings from the VCU.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>canReceive.h</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">#define TEMPERATURE_DELTA_LIMIT 30</pre>
</div></div><p><br/></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>canReceive.c</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">void checkMotorTempReading(int delta)
{
    if (delta &lt;= TEMPERATURE_DELTA_LIMIT){
        sendDTC_WARNING_MOTOR_OVERTEMP();
    }
}

void checkMotorControllerTempReading(int delta)
{
    if (delta &lt;= TEMPERATURE_DELTA_LIMIT){
        sendDTC_WARNING_MOTOR_CONTROLLER_OVERTEMP();
    }
}</pre>
</div></div><h1 id="CoolingSystem-DTCincommon-all">DTC in common-all</h1><p>2 additional lines were added to the DTC.csv in common-all <a class="external-link" href="https://bitbucket.org/waterloohybrid/common-all/src/09df5d6fbe4b56c329394843ea6c0418df6cfba8/Data/DTC.csv?at=feature%2Fwfe-778#lines-54" rel="nofollow">here</a> so the VCU can send motor and motor controller overtemp warnings:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">53,MOTOR_OVERTEMP,VCU_F7,4,PDU,NA,&quot;Motor overheating, will increase cooling on PDU. Potential for motor function failure if warming continues&quot;
54,MOTOR_CONTROLLER_OVERTEMP,VCU_F7,4,PDU,NA,&quot;Motor controller overheating, will increase cooling on PDU. Potential for motor function failure if warming continues&quot;</pre>
</div></div><p><br/></p><p><br/></p>
                    </div>

                                        <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/9604893237/9606694714.png">PDU.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/9604893237/9606694711.png">PDU.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/9604893237/9606694716.png">PDU_old.png</a> (image/png)
                                <br/>
                                                    </div>
                    </div>
                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Oct 15, 2022 01:35</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
