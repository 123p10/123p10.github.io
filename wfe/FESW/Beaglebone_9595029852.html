<!DOCTYPE html>
<html>
    <head>
        <title>Firmware : Beaglebone</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">Firmware</a></span>
                            </li>
                                                    <li>
                                <span><a href="Firmware_9465365086.html">Firmware</a></span>
                            </li>
                                                    <li>
                                <span><a href="Documentation_9513894334.html">Documentation</a></span>
                            </li>
                                                    <li>
                                <span><a href="Board-Specific-Documentation_9567701653.html">Board Specific Documentation</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            Firmware : Beaglebone
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Former user</span>, last modified by <span class='editor'> Zulaikha Zakiullah</span> on Jun 28, 2022
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p><style type='text/css'>/*<![CDATA[*/
div.rbtoc1665797707543 {padding: 0px;}
div.rbtoc1665797707543 ul {list-style: disc;margin-left: 0px;}
div.rbtoc1665797707543 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='toc-macro rbtoc1665797707543'>
<ul class='toc-indentation'>
<li><a href='#Beaglebone-Overview'>Overview</a></li>
<li><a href='#Beaglebone-CANMonitor'>CAN Monitor</a>
<ul class='toc-indentation'>
<li><a href='#Beaglebone-CANLogs'>CAN Logs</a></li>
<li><a href='#Beaglebone-CANInterface'>CAN Interface</a></li>
</ul>
</li>
<li><a href='#Beaglebone-Dashboard'>Dashboard</a></li>
</ul>
</div></p><h1 id="Beaglebone-Overview">Overview</h1><p>The Beaglebone is where we do our CAN logging and GPS logging, as well as where we run our dashboard.</p><h1 id="Beaglebone-CANMonitor">CAN Monitor</h1><p>The CAN monitor script is found in <code>/home/debian/firmware/beaglebone/app/wfe/can_monitor.py</code>. It runs automatically on Beaglebone startup. It is run as a systemd task that is registered using the file <code>/etc/systemd/system/can_monitor.service</code>. The contents of <code>can_monitor.service</code> is below.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>can_monitor.service</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">[Unit]
Description=Can Monitoring Script

[Service]
ExecStart=python3 /home/debian/firmware/beaglebone/app/wfe/can_monitor.py -d /home/debian/firmware/common/Data/2018CAR.dbc

[Install]
WantedBy=multi-user.target</pre>
</div></div><h2 id="Beaglebone-CANLogs">CAN Logs</h2><p>The CAN monitor script creates a log file and CSV file when it starts up. The file naming convention is by date. The files are automatically generated in <code>/home/debian/can_monitor_logs</code>. Example log and CSV files are shown below.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Example CAN log file</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence">2022-03-29 23:33:31,923 - DEBUG - Message received: Timestamp: 1648596811.750647    ID: 18800401    X Rx                DL:  8    02 7e 87 b4 87 af 87 00     Channel: can1
2022-03-29 23:33:31,943 - DEBUG - Decoded signals: {&#39;VoltageCellMuxSelect&#39;: 2, &#39;VoltageCell07&#39;: 3.4686000000000003, &#39;VoltageCell08&#39;: 3.474, &#39;VoltageCell09&#39;: 3.4735}
2022-03-29 23:33:31,994 - DEBUG - Message received: Timestamp: 1648596811.750922    ID: 18c00401    X Rx                DL:  8    02 34 30 0e 30 2f 30 00     Channel: can1
2022-03-29 23:33:32,014 - DEBUG - Decoded signals: {&#39;TempCellMuxSelect&#39;: 2, &#39;TempCell07&#39;: 23.400000000000006, &#39;TempCell08&#39;: 23.019999999999996, &#39;TempCell09&#39;: 23.35000000000001}
2022-03-29 23:33:32,035 - DEBUG - Message received: Timestamp: 1648596811.790092    ID: 18800401    X Rx                DL:  8    03 b0 87 ad 87 bc 87 00     Channel: can1
2022-03-29 23:33:32,061 - DEBUG - Decoded signals: {&#39;VoltageCellMuxSelect&#39;: 3, &#39;VoltageCell10&#39;: 3.4736000000000002, &#39;VoltageCell11&#39;: 3.4733, &#39;VoltageCell12&#39;: 3.4748}
2022-03-29 23:33:32,093 - DEBUG - Message received: Timestamp: 1648596811.790337    ID: 18c00401    X Rx                DL:  8    03 0e 30 3b 30 0f 30 00     Channel: can1
2022-03-29 23:33:32,095 - DEBUG - Decoded signals: {&#39;TempCellMuxSelect&#39;: 3, &#39;TempCell10&#39;: 23.019999999999996, &#39;TempCell11&#39;: 23.47, &#39;TempCell12&#39;: 23.03}
2022-03-29 23:33:32,123 - DEBUG - Message received: Timestamp: 1648596811.806649    ID: 08100302    X Rx                DL:  5    00 00 0a 00 ae              Channel: can1
2022-03-29 23:33:32,149 - DEBUG - Decoded signals: {&#39;ThrottlePercent&#39;: 0, &#39;BrakePercent&#39;: 0, &#39;brakePressure&#39;: 10, &#39;SteeringAngle&#39;: -82}
2022-03-29 23:33:32,184 - DEBUG - Message received: Timestamp: 1648596811.835432    ID: 08041001    X Rx                DL:  8    85 01 40 42 f8 d2 1b 00     Channel: can1</pre>
</div></div><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Example CAN CSV file</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence">Timestamp,Signal,Value
1651008952,VoltageBusLV,11987
1651008952,CurrentBusLV,293
1651008953,FL_WheelDistance,0
1651008953,SpeedWheelLeftFront,2.77E-13
1651008953,StrainXLeftFront,0
1651008953,StrainYLeftFront,0
1651008953,StrainZLeftFront,0
1651008953,PDU_Heartbeat_dummydata,0</pre>
</div></div><p><br/></p><h2 id="Beaglebone-CANInterface">CAN Interface</h2><p>The CAN interface is set up on Beaglebone startup. This is done through the <code>/etc/network/interfaces</code> file. The end of the file is shown below, where the <code>can1</code> interface is set up, which the CAN monitor listens to.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>End of /etc/network/interfaces</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">auto can1
iface can1 inet manual
	pre-up /sbin/ip link set can1 type can bitrate 500000 triple-sampling on restart-ms 100
	up /sbin/ifconfig can1 up
	down /sbin/ifconfig can1 down</pre>
</div></div><p><br/></p><h1 id="Beaglebone-Dashboard">Dashboard</h1><p>The dashboard script is found in <code>/home/debian/firmware/beaglebone/app/wfe/dashboard.py</code>. It runs automatically on startup. To do this, we configure both <code>~/.xinitrc</code> and <code>~/.bash_profile</code>, shown below.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>~/.xinitrc</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: bash; gutter: false; theme: Confluence" data-theme="Confluence">python3 /home/debian/firmware/beaglebone/app/wfe/dashboard.py</pre>
</div></div><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>~/.bash_profile</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: bash; gutter: false; theme: Confluence" data-theme="Confluence">if [ -z &quot;${DISPLAY}&quot; ] &amp;&amp; [ ! -z &quot;${XDG_VTNR}&quot; ] &amp;&amp; [ &quot;${XDG_VTNR}&quot; -eq 1 ]; then
	exec startx -- -nocursor
fi</pre>
</div></div>
                    </div>

                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Oct 15, 2022 01:35</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
