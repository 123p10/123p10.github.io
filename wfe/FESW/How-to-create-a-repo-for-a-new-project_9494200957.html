<!DOCTYPE html>
<html>
    <head>
        <title>Firmware : How to create a repo for a new project</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">Firmware</a></span>
                            </li>
                                                    <li>
                                <span><a href="Firmware_9465365086.html">Firmware</a></span>
                            </li>
                                                    <li>
                                <span><a href="Getting-Started_9465365137.html">Getting Started</a></span>
                            </li>
                                                    <li>
                                <span><a href="Intro-to-Firmware_9465365151.html">Intro to Firmware</a></span>
                            </li>
                                                    <li>
                                <span><a href="Sample-Firmware-Project_9465365169.html">Sample Firmware Project</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            Firmware : How to create a repo for a new project
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Former user</span>, last modified by <span class='editor'> Former user</span> on Apr 10, 2019
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p>When starting firmware for a new board</p><h2 id="Howtocreatearepoforanewproject-Step-by-stepguide">Step-by-step guide</h2><p></p><ol><li>Create a new repo on Bitbucket</li><li>Clone repo to your computer</li><li>cd into your new repo </li><li>add the .gitignore file</li><li>pull in the common submodule: git submodule add <a class="external-link" href="mailto:git@bitbucket.org" rel="nofollow">git@bitbucket.org</a>:waterloohybrid/common-all.git</li><li>As of writing, you need to change branch in common-all to multi-platform-support (If this branch doesn't exist any more, it was probably merged into master, so you don't need to do this)</li><li>copy the sample make file from common to the root of the repo: <span style="letter-spacing: 0.0px;">cp common-all/sample-project-makefile</span></li><li>rename the makefile to makefile and update the board name and processor types</li><li>Create a Inc and Src directory in the project root</li><li><span>Add a </span>bsp.h file to root Inc directory</li><li>Create a folder for each platform you wish to target (Supported ones as of writing are: Nucleo-F0, F0, Nucleo-F7, F7, see boardTypes.c in common-all)</li><li>Add a CubeMX .ioc to the folder for each platform</li><li>Enable freeRTOS in CubeMX, and create the mainTask (do this for each platform)</li><li>create a timer for the stats generation, this should be any free 16 bit or larger timer. All you need to do is enable it in cube by choosing the clock source as internal, the debug.c will configure the prescaler and period and start it. Then define STATS_TIM_HANDLE in the bsp</li><li>Create a Cube-Lib.mk file for each platform<ol><li>This is just a modified version of the Makefile that CubeMX generates</li><li>Run code gen in CubeMX to get a Makefile, then diff it with the sample-Cube-Lib.mk file in common-all to get an idea of what to change</li><li>Major things to change:<ol><li>Create this variable: THIS_MAKEFILE_PATH := $(&lt;change to name of makefile path in main Makefile, eg CUBE_NUCLEO_F0_MAKEFILE_PATH&gt;)</li><li>Add Lib_ prefix to all makefile variables</li><li>Delete build rules (not optional), and some unused variables (Optional)</li><li>Use a line like this to add the makefile path to all source and include files: LIB_C_SOURCES := $(addprefix $(THIS_MAKEFILE_PATH), $(LIB_C_SOURCES))</li><li>For includes, need to remove -I prefix from file names, add in the line for makefile path, then add back -I prefix with this line: <span style="letter-spacing: 0.0px;">LIB_C_INCLUDES := $(addprefix -I, $(LIB_C_INCLUDES))</span></li><li><span style="letter-spacing: 0.0px;">add -c to ASFLAG and CFLAGS</span></li></ol></li></ol></li><li>Create a userInit.c and mainTaskEntry.c file in root Src directory with desired behaviour (should implement mainTaskFunction, and userInit functions)</li><li>In main.c for each platform, call userInit before freeRTOS starts, and implement Error_Handler and assert_failed functions</li><li>The project should be ready, try to build</li><li>If it fails, check these:<ol><li>error message next to __weak in FreeRTOS.c<ol><li>Add this line in the user includes section: '<span style="letter-spacing: 0.0px;">#include &quot;stm32f0xx_hal.h&quot;'</span></li></ol></li><li>Error message: implicit declaration of function 'xPortSysTickHandler'<ol><li>Add this line in the user code section at the top of stm32fxxx_it.c<p>'extern void xPortSysTickHandler(void);'</p></li></ol></li></ol></li></ol><p> </p><div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"></div></div><h2 id="Howtocreatearepoforanewproject-Relatedarticles">Related articles</h2><p></p><p>











<ul class="content-by-label">
        <li>
        <div>
                <span class="icon aui-icon aui-icon-small aui-iconfont-page-default" title="Page">Page:</span>        </div>

        <div class="details">
                                    <a data-linked-resource-id="9494200957" data-linked-resource-type="page" data-linked-resource-version="2" href="/wiki/spaces/FESW/pages/9494200957/How+to+create+a+repo+for+a+new+project">How to create a repo for a new project</a>
                        
                        
                    </div>
    </li>
        <li>
        <div>
                <span class="icon aui-icon aui-icon-small aui-iconfont-page-default" title="Page">Page:</span>        </div>

        <div class="details">
                                    <a data-linked-resource-id="9444361512" data-linked-resource-type="page" data-linked-resource-version="1" href="/wiki/spaces/FESW/pages/9444361512/FreeRTOS">FreeRTOS</a>
                        
                        
                    </div>
    </li>
    </ul>
</p><p><br/></p><p><br/></p>
                    </div>

                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Oct 15, 2022 01:32</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
